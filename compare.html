<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CSOC Incident Summary</title>
  <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
  <link rel="shortcut icon" href="/static/favicon.svg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- CSS -->
  <link rel="stylesheet" href="/static/compare.css?v=3">
  <link rel="stylesheet" href="/static/theme.css?v=2">
  <link rel="stylesheet" href="/static/css/compare-profile.css">

</head>
<body>
  <!-- ============ HEADER ============ -->
  <header>
    <div style="display: flex; align-items: center; gap: 12px;">
      <button id="btnSidebarToggle" style="padding: 8px 12px; font-size: 14px;">‚ò∞</button>
      <h1>CSOC Incident Summary</h1>
    </div>
    <div style="display: flex; align-items: center; gap: 8px; flex-wrap: wrap;">
      <div style="display: flex; gap: 6px; flex-wrap: wrap;">
        <button id="btnExportXLSX" disabled style="font-size: 12px; padding: 6px 10px;">Excel</button>
        <button id="btnExportSummary" disabled style="font-size: 12px; padding: 6px 10px;">Summary</button>
        <button id="btnExportPNG" disabled style="font-size: 12px; padding: 6px 10px;">PNG</button>
        <button id="btnExportPDF" disabled style="font-size: 12px; padding: 6px 10px;">PDF</button>
      </div>
      <button id="btnTheme" onclick="toggleTheme()" style="font-size: 12px; padding: 6px 10px;">üåô Dark</button>
      <div id="userProfile" style="margin-left: 8px;"></div>
    </div>
  </header>

  <!-- ============ LAYOUT ============ -->
  <div class="layout" id="layout">
    <aside id="sidebar">
      <div class="card">
        <h2>Upload</h2>
        <div class="small">‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î Master ‡∏à‡∏∞‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå default ‡∏ö‡∏ô‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå</div>
        <div style="display:flex; flex-direction:column; gap:8px; margin-top:8px">
          <label>Master (Memo): <input type="file" id="fileMaster" accept=".csv,.xlsx" /></label>
          <label>Compare (Solarwind): <input type="file" id="fileCompare" accept=".csv,.xlsx" /></label>
          <button id="btnCompare" disabled>Compare</button>
        </div>
        <div class="small" style="margin-top:6px">‡∏´‡∏•‡∏±‡∏á Compare ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á Job ‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏•‡∏∞‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ</div>
      </div>

      <div class="card jobs">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
          <h2>Jobs</h2>
          <div class="small" id="jobCount">‚Äî</div>
        </div>

        <div class="filters">
          <label class="small">From<br/><input type="date" id="jobDateFrom"/></label>
          <label class="small">To<br/><input type="date" id="jobDateTo"/></label>
          <div class="actions">
            <button id="btnJobFilter">Apply</button>
            <button id="btnJobClear">Clear</button>
          </div>
        </div>

        <!-- Admin -->
        <div class="card" id="adminCard">
          <h2>Admin</h2>
          <div class="small">‡πÉ‡∏™‡πà Token (X-Admin-Token) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡∏•‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</div>
          <div style="display:flex;gap:8px;margin-top:6px">
            <input id="adminToken" type="password" placeholder="X-Admin-Token" style="flex:1">
            <button id="btnAdminToggle">Enable</button>
          </div>
          <div class="small" id="adminStatus">Admin mode: OFF</div>
          <button id="btnBulkDelete" disabled>Delete Selected</button>
        </div>

        <ul id="jobsList"></ul>

        <div class="meta">
          <div class="small" id="jobsMeta">‚Äî</div>
          <button id="btnJobsMore" class="">‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
        </div>
      </div>
    </aside>

    <main>
      <div class="tabs">
        <button id="tabRecords" class="active">Records</button>
        <button id="tabSummary">Summary</button>
        <button id="tabReport">Report</button>

      </div>

      <!-- ===== Records ===== -->
      <section id="viewRecords">
        <!-- (‡∏•‡∏ö‡∏ü‡∏¥‡∏•‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÄ‡∏Å‡πà‡∏≤‡∏ö‡∏ô‡∏´‡∏±‡∏ß‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß) -->

        <div class="kpi">
          <div id="cardAll" class="card" data-status="">
            <div>‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div><div id="kpiAll">0</div>
          </div>
          <div id="cardMatched" class="card" data-status="Found">
            <div>Matched</div><div id="kpiMatched">0</div>
          </div>
          <div id="cardUnmatched" class="card" data-status="Unmatched">
            <div>Unmatched</div><div id="kpiUnmatched">0</div>
          </div>
        </div>

        <!-- [RECORDS] Multi-Filter ‡πÉ‡∏´‡∏°‡πà (‡∏ã‡πà‡∏≠‡∏ô‡∏ï‡∏±‡πâ‡∏á‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ display:none) -->
        <div id="advFiltersRecords" class="card hidden" style="margin:12px 0; padding:12px; gap:10px">
          <!-- ‡πÅ‡∏ñ‡∏ß‡∏ö‡∏ô: global search + ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÅ‡∏ö‡∏ö‡∏õ‡∏∏‡πà‡∏° -->
          <div style="display:grid; grid-template-columns: 1fr auto; gap:12px; align-items:center">
            <input id="mfGlobalSearch" type="search" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤/‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î/‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó/‡πÄ‡∏•‡∏Ç‡∏ß‡∏á‡∏à‡∏£/‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞/‡∏™‡∏≤‡∏Ç‡∏≤)..." />
            <div style="display:flex; gap:8px; align-items:center">
              <span class="small">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</span>
              <div class="btn-group">
                <button id="mfStatAll" class="btn">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                <button id="mfStatFound" class="btn">Matched</button>
                <button id="mfStatUnmatched" class="btn">Unmatched</button>
              </div>
              <button id="mfClearAll" class="btn">‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</button>
            </div>
          </div>

          <!-- ‡πÅ‡∏ñ‡∏ß‡∏•‡πà‡∏≤‡∏á: ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤/‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î/‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó + ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏° + ‡∏ä‡∏¥‡∏õ -->
          <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:12px">
            <div class="mf-group">
              <label class="small">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label>
              <div style="display:flex; gap:8px; align-items:center">
                <input id="mfCustomer" type="search" list="dlCustomers" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å" style="width:100%">
                <button id="mfCustomerAdd" class="btn">+</button>
              </div>
              <div id="mfCustomerChips" class="chips"></div>
            </div>

            <div class="mf-group">
              <label class="small">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</label>
              <div style="display:flex; gap:8px; align-items:center">
                <input id="mfProvince" type="search" list="dlProvincesSummaryMulti" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å" style="width:100%">
                <button id="mfProvinceAdd" class="btn">+</button>
              </div>
              <div id="mfProvinceChips" class="chips"></div>
            </div>

            <div class="mf-group">
              <label class="small">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
              <div style="display:flex; gap:8px; align-items:center">
                <input id="mfType" type="search" list="dlTypes" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å" style="width:100%">
                <!-- dlTypes ‡πÉ‡∏ä‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ -->
                <datalist id="dlTypes"></datalist>
                <button id="mfTypeAdd" class="btn">+</button>
              </div>
              <div id="mfTypeChips" class="chips"></div>
            </div>
          </div>
        </div>

        <div class="tablewrap">
          <table>
            <colgroup>
              <col><col><col><col><col><col><col><col>
            </colgroup>
            <thead>
              <tr>
                <th>#</th>
                <th>‡πÄ‡∏•‡∏Ç‡∏ß‡∏á‡∏à‡∏£</th>
                <th>‡∏™‡∏≤‡∏Ç‡∏≤</th>
                <th>SLA</th>
                <th>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th>
                <th>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</th>
                <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
              </tr>
            </thead>
            <tbody id="tbody"></tbody>
          </table>
        </div>

        <div class="meta-row">
          <div class="small" id="recordsMeta">‚Äî</div>
          <button id="btnMoreRecords">‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
        </div>
      </section>

      <!-- ===== Summary ===== -->
      <section id="viewSummary" class="hidden">

        <!-- (‡∏•‡∏ö‡πÅ‡∏ñ‡∏ö summarybar ‡πÄ‡∏Å‡πà‡∏≤‡∏≠‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß) -->

        <!-- [SUMMARY] Multi-Filter ‡πÉ‡∏´‡∏°‡πà -->
        <div id="advFilters" class="card hidden" style="margin:12px 0; padding:12px; gap:10px">
          <!-- ‡πÅ‡∏ñ‡∏ß‡∏ö‡∏ô: global search + ‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (Summary ‡πÉ‡∏ä‡πâ All ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß) -->
          <div style="display:grid; grid-template-columns: 1fr auto; gap:12px; align-items:center">
            <input id="mfGlobalSearch" type="search" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤/‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î/‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó/‡πÄ‡∏•‡∏Ç‡∏ß‡∏á‡∏à‡∏£/‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞/‡∏™‡∏≤‡∏Ç‡∏≤)..." />
            <div style="display:flex; gap:8px; align-items:center">
              <span class="small">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</span>
              <div class="btn-group">
                <button id="mfStatAll" class="btn">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
              </div>
              <button id="mfClearAll" class="btn">‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</button>
            </div>
          </div>

          <!-- ‡πÅ‡∏ñ‡∏ß‡∏•‡πà‡∏≤‡∏á: ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤/‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î/‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó + ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏° + ‡∏ä‡∏¥‡∏õ -->
          <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:12px">
            <div class="mf-group">
              <label class="small">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</label>
              <div style="display:flex; gap:8px; align-items:center">
                <input id="mfCustomer" type="search" list="dlCustomers" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å" style="width:100%">
                <button id="mfCustomerAdd" class="btn">+</button>
              </div>
              <div id="mfCustomerChips" class="chips"></div>
            </div>

            <div class="mf-group">
              <label class="small">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</label>
              <div style="display:flex; gap:8px; align-items:center">
                <input id="mfProvince" type="search" list="dlProvincesSummaryMulti" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å" style="width:100%">
                <button id="mfProvinceAdd" class="btn">+</button>
              </div>
              <div id="mfProvinceChips" class="chips"></div>
            </div>

            <div class="mf-group">
              <label class="small">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
              <div style="display:flex; gap:8px; align-items:center">
                <input id="mfType" type="search" list="dlTypes" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å" style="width:100%">
                <datalist id="dlTypes"></datalist>
                <button id="mfTypeAdd" class="btn">+</button>
              </div>
              <div id="mfTypeChips" class="chips"></div>
            </div>
          </div>

          <!-- ‡πÉ‡∏™‡πà datalist ‡∏ó‡∏µ‡πà‡πÄ‡∏î‡∏¥‡∏°‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô summarybar ‡πÄ‡∏Å‡πà‡∏≤ ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö list= ‡∏Ç‡∏≠‡∏á input -->
          <datalist id="dlCustomers"></datalist>
          <datalist id="dlProvincesSummaryMulti"></datalist>
        </div>

        <div class="tablewrap">
          <table>
            <thead>
              <tr><th>#</th><th>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th><th>‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</th><th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏á‡∏à‡∏£</th><th>‡πÄ‡∏•‡∏Ç‡∏ß‡∏á‡∏à‡∏£</th></tr>
            </thead>
            <tbody id="tbodyOurSummary"></tbody>
          </table>
        </div>

        <div class="meta-row">
          <div class="small" id="summaryMeta">‚Äî</div>
          <button id="btnMoreSummary">‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
        </div>
      </section>

      <!-- ===== Report ===== -->
      <section id="viewReport" class="hidden">
        <div class="summarybar">
          <input id="reportProvinceInput" type="search" placeholder="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‚Ä¶" list="dlProvincesReport" style="min-width:220px">
          <datalist id="dlProvincesReport"></datalist>
          <button id="btnAddProvince">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</button>
          <button id="btnClearReportFilters">‡∏•‡πâ‡∏≤‡∏á‡∏ü‡∏¥‡∏•‡πÄ‡∏ï‡∏≠‡∏£‡πå</button>
          <span class="small">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:</span>
          <div id="reportProvinceChips" class="chips"></div>
          <span class="status" id="reportStatusMsg"></span>
        </div>

        <div id="reportCapture">
          <div class="kpi kpi-report">
            <div class="card metric">
              <div class="title">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</div>
              <div class="value" id="kpiAffectedCustomers">0</div>
            </div>
            <div class="card metric">
              <div class="title">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏™‡∏µ‡∏¢</div>
              <div class="value" id="kpiAffectedCircuits">0</div>
            </div>
            <div class="card" id="serviceCard">
              <div class="title">Service</div>
              <div class="svc-row"><span>Data</span><strong id="kpiData">0</strong></div>
              <div class="svc-row"><span>Broadband</span><strong id="kpiBroadband">0</strong></div>
              <div class="svc-row"><span>Voice</span><strong id="kpiVoice">0</strong></div>
            </div>
            <div class="card" id="provinceCard">
              <div class="title">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</div>
              <div class="value">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <span id="kpiAffectedProvinces">0</span> ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</div>
              <div id="kpiProvinceList" class="province-box"></div>
            </div>
          </div>

          <div class="charts-grid">
            <div class="card chart-card">
              <div class="chart-title">Service</div>
              <canvas id="svcPie"></canvas>
            </div>
            <div class="card chart-card">
              <div class="chart-title">Province (Top)</div>
              <canvas id="provPie"></canvas>
            </div>
          </div>

          <div class="card insights-card" style="margin-top:12px">
            <div class="title">Hotspots (Top 5 ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î)</div>
            <div id="hotspots"></div>
          </div>

          <div class="small" id="reportNote" style="margin-top:8px">‚Äî</div>
        </div>
      </section>


    </main>
  </div>

  <!-- Loading Overlay -->
  <div id="loadingOverlay">
    <div class="box">
      <span class="spinner"></span><span id="loadingText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‚Ä¶</span>
    </div>
  </div>

  <!-- ‡πÇ‡∏°‡∏î‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤ -->
  <script defer src="/static/js/auth.utils.js"></script>
  <script defer src="/static/js/app.utils.js?v=3"></script>
  <script defer src="/static/js/app.state.js?v=3"></script>
  <script defer src="/static/js/app.api.js?v=3"></script>

  <!-- ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏´‡πâ report ‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô records -->
  <script defer src="/static/js/app.report.js?v=3"></script>
  <script defer src="/static/js/app.records.js?v=3"></script>
  <script defer src="/static/js/app.summary.js?v=3"></script>
  <script defer src="/static/js/app.jobs.js?v=3"></script>
  <script defer src="/static/js/app.export.js?v=3"></script>
  <script defer src="/static/js/app.bootstrap.js?v=3"></script>

  
  <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Theme Toggle -->
  <script defer src="/static/js/app.theme.js?v=1"></script>
  <script>
    // Theme toggle functionality
    function toggleTheme() {
      const html = document.documentElement;
      const btn = document.getElementById('btnTheme');
      const currentTheme = html.getAttribute('data-theme') || 'light';
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      
      html.setAttribute('data-theme', newTheme);
      btn.textContent = newTheme === 'light' ? 'üåô Dark' : '‚òÄÔ∏è Light';
      localStorage.setItem('theme', newTheme);
      
      // Sync theme to parent (iframe)
      try {
        if (window.parent !== window) {
          window.parent.postMessage({ type: 'themeChanged', theme: newTheme }, '*');
        }
      } catch (e) {
        // Ignore cross-origin errors
      }
    }
    
    // Listen for theme changes from parent (iframe)
    window.addEventListener('message', (e) => {
      if (e.data.type === 'themeChanged') {
        const newTheme = e.data.theme;
        const html = document.documentElement;
        const btn = document.getElementById('btnTheme');
        
        html.setAttribute('data-theme', newTheme);
        if (btn) {
          btn.textContent = newTheme === 'light' ? 'üåô Dark' : '‚òÄÔ∏è Light';
        }
      }
    });
    
    // Load saved theme on page load
    document.addEventListener('DOMContentLoaded', () => {
      const savedTheme = localStorage.getItem('theme') || 'light';
      document.documentElement.setAttribute('data-theme', savedTheme);
      const themeBtn = document.getElementById('btnTheme');
      if (themeBtn) {
        themeBtn.textContent = savedTheme === 'light' ? 'üåô Dark' : '‚òÄÔ∏è Light';
      }
      
      // Initialize user profile
      const userProfileElement = document.getElementById('userProfile');
      if (userProfileElement && AuthManager.isAuthenticated()) {
        userProfileElement.innerHTML = AuthManager.createUserProfile();
      }
      
      // Sidebar toggle functionality - send message to parent
      const btnToggle = document.getElementById('btnSidebarToggle');
      
      if (btnToggle) {
        btnToggle.addEventListener('click', () => {
          try {
            if (window.parent !== window) {
              window.parent.postMessage({ type: 'toggleSidebar' }, '*');
            }
          } catch (e) {
            // Ignore cross-origin errors
          }
        });
      }
    });
  </script>
</body>
</html>
